<!doctype html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Склад</title>
    <link rel="icon" type="image/x-icon" href="assets/img/Contest.ico">

    <!-- Style -->
    <link href="assets/css/jetbrains.css" rel="stylesheet">
    <link href="assets/css/jetbrains-components.css" rel="stylesheet">
    <link href="assets/css/bootstrap-grid.css" rel="stylesheet">
    <link href="assets/css/contest-main.css" rel="stylesheet">
    <!-- End style -->



</head>
<body class="theme-dark">
<!-- Theme change  -->
<script src="assets/js/theme.js"></script>
<!-- End theme change  -->

<div class="page">
    <!-- Header -->
    <header class="d-flex flex-wrap justify-content-md-between mb-4 px-4 border-bottom">
        <!-- Gradient -->
        <div class="gradient" style="background: var(--gradient-4)"></div>
        <a href="#" class="link link-default link-underline-none tb ms-2 d-flex align-items-center" >
            <img src="assets/img/Contest.png" class="logo me-2">
            <h6>Твой Кролик Написал</h6>
        </a>

        <div class="text-end d-inline-flex align-items-center">
            <a class="link link-default tb ms-3 d-inline-flex align-items-center" href="#">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-github me-2" viewBox="0 0 16 16">
                    <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path>
                </svg> GitHub</a>
            <a class="link link-default tb ms-3 d-inline-flex align-items-center" href="#">Главная</a>
            <a class="link link-default tb ms-3 d-inline-flex align-items-center" href="#">Компиляторы и ошибки</a>
            <a class="link link-default tb ms-3 d-inline-flex align-items-center" href="#">Обзор</a>

            <div class="drop-down ms-3" >
                <a id="drop-down-btn-1" class="drop-down__button">Drop down</a>
                <ul class="drop-down__list drop-down__list-right">
                    <li class="drop-down__list-item" data-value="8"><h6>Профиль</h6></li>
                    <li class="drop-down__list-delimiter"></li>
                    <li class="drop-down__list-item" data-value="8"><a class="link link-default " href="#">Реактор тестов</a></li>
                    <li class="drop-down__list-item" data-value="8"><a class="link link-default " href="#">Отчимтить кеш</a></li>
                    <li class="drop-down__list-delimiter"></li>
                    <li class="drop-down__list-item" data-value="8"><a class="link link-default " href="#">Выход</a></li>
                </ul>
            </div>
        </div>
    </header>
    <!-- End header -->

    <!-- Body -->
    <div class="main-panel align-items-center">
        <div class="content-wrapper">
            <div class="row">
                <div class="col-xl-2 col-sm-6 grid-margin stretch-card p-1">
                    <h5>Заказы</h5>
                    <br>
                    <table class="table table-hover">
                        <thead>
                        <tr>
                            <th>Номер</th>
                            <th>Статус</th>
                            <th>Заказ</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td>123</td>
                            <td>Ожидает обработки</td>
                            <td>X4</td>
                        </tr>
                        <tr>
                            <td>324</td>
                            <td>В обработке</td>
                            <td>X2</td>
                        </tr>
                        <tr>
                            <td>642</td>
                            <td>Завершён</td>
                            <td>X6</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div class="col-xl-8 col-sm-6 grid-margin stretch-card">
                    <h5>Склад</h5>
                    <br>
                    <div style="width: 100%; height: 80vh; background: #555" id="stock_canvas_parent">
                        <canvas id="stock_canvas"></canvas>
                    </div>
                </div>
                <div class="col-xl-2 col-sm-6 grid-margin stretch-card">
                    <h5>Погрузчики</h5>
                    <br>

                    <table class="table table-hover">
                        <thead>
                        <tr>
                            <th>Номер</th>
                            <th>Статус</th>
                            <th>Заказ</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td>123</td>
                            <td>Ожидаю заказ</td>
                            <td>X4</td>
                        </tr>
                        <tr>
                            <td>324</td>
                            <td>Еду за заказом</td>
                            <td>X2</td>
                        </tr>
                        <tr>
                            <td>642</td>
                            <td>Возвращаюсь с заказом</td>
                            <td>X6</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <!-- End body -->

    <!-- Footer -->
    <footer class="text-center">
        <!-- Copyright -->
        <div class="text-end d-inline-flex align-items-center p-4">
            <span class="tb">© 2023 Все права защищены.</span>
            <a class="link tb ms-3 d-inline-flex align-items-center" href="https://github.com/Voyadger-Odin" target="_blank">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-github me-2" viewBox="0 0 16 16">
                    <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path>
                </svg>
                <span style="margin-left: 5px">Voyadger-Odin</span>
            </a>
            <a class="link tb ms-3 d-inline-flex align-items-center" href="https://t.me/rosetomorrow" target="_blank">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-telegram" viewBox="0 0 16 16">
                    <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8.287 5.906c-.778.324-2.334.994-4.666 2.01-.378.15-.577.298-.595.442-.03.243.275.339.69.47l.175.055c.408.133.958.288 1.243.294.26.006.549-.1.868-.32 2.179-1.471 3.304-2.214 3.374-2.23.05-.012.12-.026.166.016.047.041.042.12.037.141-.03.129-1.227 1.241-1.846 1.817-.193.18-.33.307-.358.336a8.154 8.154 0 0 1-.188.186c-.38.366-.664.64.015 1.088.327.216.589.393.85.571.284.194.568.387.936.629.093.06.183.125.27.187.331.236.63.448.997.414.214-.02.435-.22.547-.82.265-1.417.786-4.486.906-5.751a1.426 1.426 0 0 0-.013-.315.337.337 0 0 0-.114-.217.526.526 0 0 0-.31-.093c-.3.005-.763.166-2.984 1.09z"></path>
                </svg>
                <span style="margin-left: 5px">rosetomorrow</span>
            </a>
        </div>
        <!-- Copyright -->
    </footer>
    <!-- End footer -->
</div>


<!-- Scripts -->
<script src="assets/js/jetbrains.js"></script>

<script>
    let stock_canvas_parent_react = document.querySelector('#stock_canvas_parent').getBoundingClientRect()
    let stock_canvas = document.querySelector('#stock_canvas')
    const stock_data = JSON.parse('{"1": {"path_sequence": [{"check_point_id": 1, "check_point_name": "K1", "next_check_point_distance": 5}, {"check_point_id": 2, "check_point_name": "K2", "next_check_point_distance": 10}, {"check_point_id": 3, "check_point_name": "K3", "next_check_point_distance": 10}], "target_rack_id": "X1", "row_id": 1}, "2": {"path_sequence": [{"check_point_id": 1, "check_point_name": "K1", "next_check_point_distance": 5}, {"check_point_id": 2, "check_point_name": "K2", "next_check_point_distance": 10}, {"check_point_id": 3, "check_point_name": "K3", "next_check_point_distance": 15}, {"check_point_id": 4, "check_point_name": "K4", "next_check_point_distance": 10}], "target_rack_id": "X2", "row_id": 1}, "3": {"path_sequence": [{"check_point_id": 1, "check_point_name": "K1", "next_check_point_distance": 5}, {"check_point_id": 2, "check_point_name": "K2", "next_check_point_distance": 5}, {"check_point_id": 5, "check_point_name": "K5", "next_check_point_distance": 10}, {"check_point_id": 6, "check_point_name": "K6", "next_check_point_distance": 10}], "target_rack_id": "X3", "row_id": 2}, "4": {"path_sequence": [{"check_point_id": 1, "check_point_name": "K1", "next_check_point_distance": 5}, {"check_point_id": 2, "check_point_name": "K2", "next_check_point_distance": 5}, {"check_point_id": 5, "check_point_name": "K5", "next_check_point_distance": 10}, {"check_point_id": 6, "check_point_name": "K6", "next_check_point_distance": 15}, {"check_point_id": 7, "check_point_name": "K7", "next_check_point_distance": 10}], "target_rack_id": "X4", "row_id": 2}, "5": {"path_sequence": [{"check_point_id": 1, "check_point_name": "K1", "next_check_point_distance": 5}, {"check_point_id": 2, "check_point_name": "K2", "next_check_point_distance": 5}, {"check_point_id": 5, "check_point_name": "K5", "next_check_point_distance": 5}, {"check_point_id": 8, "check_point_name": "K8", "next_check_point_distance": 10}, {"check_point_id": 9, "check_point_name": "K9", "next_check_point_distance": 5}], "target_rack_id": "X5", "row_id": 3}, "6": {"path_sequence": [{"check_point_id": 1, "check_point_name": "K1", "next_check_point_distance": 5}, {"check_point_id": 2, "check_point_name": "K2", "next_check_point_distance": 5}, {"check_point_id": 5, "check_point_name": "K5", "next_check_point_distance": 5}, {"check_point_id": 8, "check_point_name": "K8", "next_check_point_distance": 10}, {"check_point_id": 9, "check_point_name": "K9", "next_check_point_distance": 15}, {"check_point_id": 10, "check_point_name": "K10", "next_check_point_distance": 10}], "target_rack_id": "X6", "row_id": 3}}')
    console.log(stock_data)

    class MainCanvas {
        constructor(canvas, rect, mainColor) {
            this.canvas = canvas
            this.rect = rect
            this.context = canvas.getContext('2d')
            this.canvas.width = rect.width
            this.canvas.height = rect.height
            this.objects = []
            this.mainColor = mainColor
            this.clear()
        }

        addObject(obj){
            this.objects.push(obj)
            this.repaint()
        }

        clear(){
            this.context.beginPath()
            this.context.moveTo(0, 0)
            this.context.rect(0, 0, this.rect.width, this.rect.height)
            this.context.fillStyle = this.mainColor
            this.context.fill()
        }

        hover(x, y) {
            this.objects.forEach((obj) => {
                obj.hover(x, y)
            })
        }

        click(x, y) {
            this.objects.forEach((obj) => {
                obj.click(x, y)
            })
        }

        repaint(){
            this.clear()
            this.objects.forEach((obj) => {
                obj.print()
            })
        }
    }

    class CanvasObj {
        constructor(mainCanvas) {

        }

        print(){}
        hover(x, y){}
        click(x, y){}
    }

    // Погрузчик
    class LoaderObj extends CanvasObj{

        mainColor = '#333'
        hoverColor = '#f33'
        color = this.mainColor

        constructor(mainCanvas, x, y, id) {
            super();
            this.mainCanvas = mainCanvas
            this.x = x
            this.y = y
            this.id = id
            this.width = 20
            this.height = 30
            mainCanvas.addObject(this)
        }

        setPosition(x, y){
            this.x = x
            this.y = y
            this.mainCanvas.repaint()
        }

        print() {
            const context = this.mainCanvas.context
            context.beginPath()
            context.moveTo(this.x, this.y)
            context.rect(this.x - this.width / 2, this.y - this.height / 2, this.width, this.height)
            context.moveTo(this.x - this.width / 4, this.y - this.height / 2)
            context.lineTo(this.x - this.width / 4, this.y - this.height / 1.2)
            context.moveTo(this.x + this.width / 4, this.y - this.height / 2)
            context.lineTo(this.x + this.width / 4, this.y - this.height / 1.2)
            context.lineCap = 'round'
            context.lineWidth = 3
            context.fillStyle = this.color
            context.stroke()
            context.fill()
        }

        hover(x, y) {
            if (
                x >= this.x - this.width / 2 &&
                x <= this.x + this.width / 2 &&
                y >= this.y - this.height / 2 &&
                y <= this.y + this.height / 2
            ){
                this.color = this.hoverColor
            }else{
                this.color = this.mainColor
            }
            this.mainCanvas.repaint()
        }

        click(x, y){
            if (
                x >= this.x - this.width / 2 &&
                x <= this.x + this.width / 2 &&
                y >= this.y - this.height / 2 &&
                y <= this.y + this.height / 2
            ){
                alert(this.id)
            }
        }

    }

    // Датчик
    class SensorObj extends CanvasObj{
        constructor(mainCanvas, name) {
            super()
            this.mainCanvas = mainCanvas
            this.name = name
            this.x = 600
            this.y = 200
            this.size = 30
            mainCanvas.addObject(this)
        }

        setPosition(x, y){
            this.x = x
            this.y = y
            this.mainCanvas.repaint()
        }

        print() {
            const context = this.mainCanvas.context
            const color = '#333a'
            context.beginPath()
            context.moveTo(this.x, this.y)
            context.rect(this.x - this.size / 2, this.y - this.size / 2, this.size, this.size)
            context.lineCap = 'round'
            context.lineWidth = 3
            context.fillStyle = color
            context.stroke()
            context.fill()
            context.fillStyle = '#000'
            context.textAlign = 'center'
            context.textBaseline = 'middle'
            context.font = "bold 10pt sans-serif";
            context.fillText(this.name, this.x, this.y);
        }

    }

    // Стеллаж
    class StackObj extends CanvasObj{
        constructor(mainCanvas, x, y, items) {
            super()
            this.mainCanvas = mainCanvas
            this.name = name
            this.x = x
            this.y = y
            this.widthSection = 200
            this.items = items
            mainCanvas.addObject(this)
        }

        setPosition(x, y){
            this.x = x
            this.y = y
            this.mainCanvas.repaint()
        }

        print() {
            const context = this.mainCanvas.context
            const color = '#333a'
            let height = 40
            context.beginPath()
            context.moveTo(this.x, this.y)
            context.rect(this.x - this.items.length * this.widthSection, this.y - height / 2, this.items.length * this.widthSection, height)
            context.lineCap = 'round'
            context.lineWidth = 3
            context.fillStyle = color
            context.stroke()
            context.fill()

            let i = 0
            this.items.forEach((item) => {
                i += 1
                context.fillStyle = '#000'
                context.textAlign = 'center'
                context.textBaseline = 'middle'
                context.font = "20px sans-serif";
                context.fillText(item, this.x - this.widthSection * i + 40, this.y);
            })
        }

    }



    const mainCanvas = new MainCanvas(stock_canvas, stock_canvas_parent_react, '#555')

    let loader_1 = new LoaderObj(mainCanvas, 100, 200, 1)
    let loader_2 = new LoaderObj(mainCanvas, 200, 200, 2)
    let sensor_1 = new SensorObj(mainCanvas, 'K1')
    let stack_1 = new StackObj(mainCanvas, 600, 500, ['X1', 'X2'])
    let stack_2 = new StackObj(mainCanvas, 600, 400, ['X3', 'X4'])
    let stack_3 = new StackObj(mainCanvas, 600, 300, ['X5', 'X6'])

    loader_1.setPosition(40, 300)




    stock_canvas.addEventListener('mousemove', function (event) {
        const div_pos = stock_canvas.getBoundingClientRect()
        const x = (event.x - div_pos.x)
        const y = (event.y - div_pos.y)
        mainCanvas.hover(x, y)
        //loader_1.setPosition(x, y)
    })

    stock_canvas.addEventListener('click', function (event) {
        const div_pos = stock_canvas.getBoundingClientRect()
        const x = (event.x - div_pos.x)
        const y = (event.y - div_pos.y)
        mainCanvas.click(x, y)
        //loader_1.setPosition(x, y)
    })


    function loop(){
        console.log('loop'); // "готово!"
    }

    // Loop
    async function f() {
        await new Promise((resolve, reject) => {
            setTimeout(() => resolve(''), 500)
        })
        loop()
        await f()
    }
    f()

</script>
<!-- End scripts -->
</body>
</html>